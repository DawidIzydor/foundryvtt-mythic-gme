{"name":"Fate Chart","type":"script","author":"IqlhGYYOCpicp39V","img":"icons/svg/clockwork.svg","scope":"global","command":"const currentChaos = game.settings.get('mythic-gme-tools', 'currentChaos')\nconst fateChartDialog = `\n<form>\n<label for=\"odds\">Odds:</label>\n<select name=\"odds\" id=\"mgme_odds\" style=\"margin-bottom: 10px;\">\n  <option value=\"i\">Impossible</option>\n  <option value=\"nw\">No way</option>\n  <option value=\"vu\">Very unlikely</option>\n  <option value=\"u\">Unlikely</option>\n  <option value=\"ff\" selected>50/50</option>\n  <option value=\"sl\">Somewhat likely</option>\n  <option value=\"l\">Likely</option>\n  <option value=\"vl\">Very likely</option>\n  <option value=\"nst\">Near sure thing</option>\n  <option value=\"ast\">A sure thing</option>\n  <option value=\"htb\">Has to be</option>\n</select> \n<label for=\"chaos\" style=\"margin-left: 5px;\">Chaos Rank:</label>\n<select name=\"chaos\" id=\"mgme_chaos\" style=\"margin-bottom: 10px;\">\n  <option value=\"9\" ${currentChaos === 9 ? 'selected' : ''}>9</option>\n  <option value=\"8\" ${currentChaos === 8 ? 'selected' : ''}>8</option>\n  <option value=\"7\" ${currentChaos === 7 ? 'selected' : ''}>7</option>\n  <option value=\"6\" ${currentChaos === 6 ? 'selected' : ''}>6</option>\n  <option value=\"5\" ${currentChaos === 5 ? 'selected' : ''}>5</option>\n  <option value=\"4\" ${currentChaos === 4 ? 'selected' : ''}>4</option>\n  <option value=\"3\" ${currentChaos === 3 ? 'selected' : ''}>3</option>\n  <option value=\"2\" ${currentChaos === 2 ? 'selected' : ''}>2</option>\n  <option value=\"1\" ${currentChaos === 1 ? 'selected' : ''}>1</option>\n</select><br>\n<label for=\"question\">Question (optional):</label>\n<input id=\"mgme_question\" style=\"margin-bottom: 10px\" placeholder=\"Fate Chart Question\">\n</form>\n`\n\nconst odds_id_map = {\n  'i': 'Impossible',\n  'nw': 'No way',\n  'vu': 'Very unlikely',\n  'u': 'Unlikely',\n  'ff': '50/50',\n  'sl': 'Somewhat likely',\n  'l': 'Likely',\n  'vl': 'Very likely',\n  'nst': 'Near sure thing',\n  'ast': 'A sure thing',\n  'htb': 'Has to be'\n}\n\nconst chart = {\n  'i': {\n    '9': 50,\n    '8': 25,\n    '7': 15,\n    '6': 10,\n    '5': 5,\n    '4': 5,\n    '3': 0,\n    '2': 0,\n    '1': -20\n  },\n  'nw': {\n    '9': 75,\n    '8': 50,\n    '7': 35,\n    '6': 25,\n    '5': 15,\n    '4': 10,\n    '3': 5,\n    '2': 5,\n    '1': 0\n  },\n  'vu': {\n    '9': 85,\n    '8': 65,\n    '7': 50,\n    '6': 45,\n    '5': 25,\n    '4': 15,\n    '3': 10,\n    '2': 5,\n    '1': 5\n  },\n  'u': {\n    '9': 90,\n    '8': 75,\n    '7': 55,\n    '6': 50,\n    '5': 35,\n    '4': 20,\n    '3': 15,\n    '2': 10,\n    '1': 5\n  },\n  'ff': {\n    '9': 95,\n    '8': 85,\n    '7': 75,\n    '6': 65,\n    '5': 50,\n    '4': 35,\n    '3': 25,\n    '2': 15,\n    '1': 10\n  },\n  'sl': {\n    '9': 95,\n    '8': 90,\n    '7': 85,\n    '6': 80,\n    '5': 65,\n    '4': 50,\n    '3': 45,\n    '2': 25,\n    '1': 20\n  },\n  'l': {\n    '9': 100,\n    '8': 95,\n    '7': 90,\n    '6': 85,\n    '5': 75,\n    '4': 55,\n    '3': 50,\n    '2': 35,\n    '1': 25\n  },\n  'vl': {\n    '9': 105,\n    '8': 95,\n    '7': 95,\n    '6': 90,\n    '5': 85,\n    '4': 75,\n    '3': 65,\n    '2': 50,\n    '1': 45\n  },\n  'nst': {\n    '9': 115,\n    '8': 100,\n    '7': 95,\n    '6': 95,\n    '5': 90,\n    '4': 80,\n    '3': 75,\n    '2': 55,\n    '1': 50\n  },\n  'ast': {\n    '9': 125,\n    '8': 110,\n    '7': 95,\n    '6': 95,\n    '5': 90,\n    '4': 85,\n    '3': 80,\n    '2': 65,\n    '1': 55\n  },\n  'htb': {\n    '9': 145,\n    '8': 130,\n    '7': 100,\n    '6': 100,\n    '5': 95,\n    '4': 95,\n    '3': 90,\n    '2': 85,\n    '1': 80\n  }\n}\n\nfunction generateOutput(odds, chaos, result) {\n  const target = chart[odds][chaos];\n  const ex_yes_bound = target * 0.2;\n  const ex_no_bound = 100-((100-target)*0.2)\n  let outcome = 'Yes!';\n  let color = 'green';\n  if (result <= ex_yes_bound) {\n    color = 'lightseagreen';\n    outcome = 'Exceptional Yes!';\n  } else if (result > ex_no_bound) {\n    color = 'red';\n    outcome = 'Exceptional No!';\n  } else if (result > target) {\n    color = 'darkred';\n    outcome = 'No!';\n  }\n  return `\n  <div><b>Roll:</b> ${result} at <em>${odds_id_map[odds]}</em> with Chaos[${chaos}]</div>\n  <b style=\"color: ${color}\">${outcome}</b>\n  `\n}\n\nlet dialogue = new Dialog({\n  title: `Fate Chart`,\n  content: fateChartDialog,\n  buttons: {\n    one: {\n      icon: '',\n      label: 'Submit',\n      callback: async (html) => {\n        const question = html.find(\"#mgme_question\").val() === '' ? \"Fate Chart Question\" : `<h2><b>${html.find(\"#mgme_question\").val()}</b></h2>`;\n        const odds = html.find(\"#mgme_odds\").val();\n        const chaos = html.find(\"#mgme_chaos\").val();\n        const roll = new Roll(`1d100`);\n        const result = roll.evaluate({async: false}).total;\n        let content = generateOutput(odds, chaos, result);\n        if (result > 10 && result < 100) {\n          const s = result.toString();\n          const macros = await game.packs.get('mythic-gme-tools.mythic-gme-macros').getDocuments();\n          if (s[0] === s[1] && s[0] <= parseInt(chaos)) {\n            content += `<div><b>Doubles!</b></div>`\n            macros.find(m => m.name === \"Random Event\").execute();\n          }\n        }\n        return roll.toMessage({\n          flavor: question,\n          content: content\n        })\n      }\n    }\n  }\n})\n\ndialogue.render(true)","folder":null,"sort":0,"permission":{"default":0,"xqxgNJxuQawzC1dQ":3,"IqlhGYYOCpicp39V":3},"flags":{"core":{"sourceId":"Macro.pkAtd1tkluuLEjbz"}},"_id":"ASghz96j9YpXIpdG"}
{"name":"Random Event","type":"script","author":"IqlhGYYOCpicp39V","img":"icons/svg/sun.svg","scope":"global","command":"const tables = await game.packs.get('mythic-gme-tools.mythic-gme-tables').getDocuments();\n\nconst focusTable = game.tables.contents.find(t => t.name === game.settings.get('mythic-gme-tools', 'focusTable')) ??\n  tables.find(t => t.name === \"Mythic GME: Event Focus\");\nconst focusRoll = await focusTable.roll();\nconst focusResult = focusRoll.results[0].getChatText();\n\nconst actionTable = game.tables.contents.find(t => t.name === game.settings.get('mythic-gme-tools', 'actionTable')) ??\n  tables.find(t => t.name === \"Mythic GME: Action Meaning\");\nconst actionRoll = await actionTable.roll();\nconst actionResult = actionRoll.results[0].getChatText();\n\nconst subjectTable = game.tables.contents.find(t => t.name === game.settings.get('mythic-gme-tools', 'subjectTable')) ??\n  tables.find(t => t.name === \"Mythic GME: Subject Meaning\");\nconst subjectRoll = await subjectTable.roll();\nconst subjectResult = subjectRoll.results[0].getChatText();\n\nlet subjectChat = {\n  content: `\n    <h2>New Event</h2>\n    <div><b>Focus: </b>${focusResult} (${focusRoll.roll.total})</div>\n    <div><b>Action: </b>${actionResult} (${actionRoll.roll.total})</div>\n    <div><b>Subject: </b>${subjectResult} (${subjectRoll.roll.total})</div>\n  `\n};\nChatMessage.create(subjectChat);","folder":null,"sort":0,"permission":{"default":0,"xqxgNJxuQawzC1dQ":3,"IqlhGYYOCpicp39V":3},"flags":{"core":{"sourceId":"Macro.PVKb2yKiyRy6xghw"}},"_id":"yiBBqAk0YOQzMZ8S"}
{"name":"Scene Alteration","type":"script","author":"IqlhGYYOCpicp39V","img":"icons/svg/explosion.svg","scope":"global","command":"const currentChaos = game.settings.get('mythic-gme-tools', 'currentChaos')\nconst sceneAlterationDialogue = `\n<form>\n<label for=\"chaos\" style=\"margin-left: 5px;\">Chaos Rank:</label>\n<select name=\"chaos\" id=\"mgme_chaos\" style=\"margin-bottom: 10px;\">\n  <option value=\"9\" ${currentChaos === 9 ? 'selected' : ''}>9</option>\n  <option value=\"8\" ${currentChaos === 8 ? 'selected' : ''}>8</option>\n  <option value=\"7\" ${currentChaos === 7 ? 'selected' : ''}>7</option>\n  <option value=\"6\" ${currentChaos === 6 ? 'selected' : ''}>6</option>\n  <option value=\"5\" ${currentChaos === 5 ? 'selected' : ''}>5</option>\n  <option value=\"4\" ${currentChaos === 4 ? 'selected' : ''}>4</option>\n  <option value=\"3\" ${currentChaos === 3 ? 'selected' : ''}>3</option>\n  <option value=\"2\" ${currentChaos === 2 ? 'selected' : ''}>2</option>\n  <option value=\"1\" ${currentChaos === 1 ? 'selected' : ''}>1</option>\n</select>\n</form>\n`\n\nlet dialogue = new Dialog({\n  title: `Scene Alteration Check`,\n  content: sceneAlterationDialogue,\n  buttons: {\n    one: {\n      icon: '',\n      label: 'Submit',\n      callback: async (html) => {\n        const chaos = parseInt(html.find(\"#mgme_chaos\").val());\n        const roll = new Roll(`1d10`);\n        const result = roll.evaluate({async: false}).total;\n        if (result <= chaos) {\n          if (result % 2 === 0) {\n            await roll.toMessage({\n              content: `<b style=\"color: darkred\">Scene was interrupted!</b> (${result})`\n            });\n            const macros = await game.packs.get('mythic-gme-tools.mythic-gme-macros').getDocuments();\n            return macros.find(m => m.name === \"Random Event\").execute();\n          } else {\n            return roll.toMessage({\n              content: `<b style=\"color: darkred\">Scene was altered!</b> (${result})`\n            });\n          }\n        } else {\n          return roll.toMessage({\n            content: `<b style=\"color: darkgreen\">Scene Proceeds Normally!</b> (${result})`\n          });\n        }\n      }\n    }\n  }\n})\n\ndialogue.render(true)","folder":null,"sort":0,"permission":{"default":0,"xqxgNJxuQawzC1dQ":3,"IqlhGYYOCpicp39V":3},"flags":{"core":{"sourceId":"Macro.aHjCw1eLIfrdkCbd"}},"_id":"H70AfMuzt5TUZbRE"}
{"name":"Increase Chaos","type":"script","author":"IqlhGYYOCpicp39V","img":"icons/svg/up.svg","scope":"global","command":"const currentChaos = game.settings.get('mythic-gme-tools', 'currentChaos')\nif (currentChaos < 9) {\n  game.settings.set('mythic-gme-tools', 'currentChaos', currentChaos + 1);\n  let chat = {\n    content: `<h2>Chaos Increased to ${currentChaos + 1}</h2>`\n  };\n  $(\"#mgme_chaos\").val(currentChaos + 1);\n  ChatMessage.create(chat);\n} else {\n  let chat = {\n    content: `<h2>Chaos already at Maximum!</h2>`\n  };\n  ChatMessage.create(chat);\n}","folder":null,"sort":0,"permission":{"default":0,"xqxgNJxuQawzC1dQ":3,"IqlhGYYOCpicp39V":3},"flags":{"core":{"sourceId":"Macro.xtGSCNZPEWYwgfOD"}},"_id":"xBEMYEfqijhj289o"}
{"name":"Decrease Chaos","type":"script","author":"IqlhGYYOCpicp39V","img":"icons/svg/down.svg","scope":"global","command":"const currentChaos = game.settings.get('mythic-gme-tools', 'currentChaos')\nif (currentChaos > 1) {\n  game.settings.set('mythic-gme-tools', 'currentChaos', currentChaos - 1);\n  let chat = {\n    content: `<h2>Chaos Decreased to ${currentChaos - 1}</h2>`\n  };\n  $(\"#mgme_chaos\").val(currentChaos - 1);\n  ChatMessage.create(chat);\n} else {\n  let chat = {\n    content: `<h2>Chaos already at Minimum!</h2>`\n  };\n  ChatMessage.create(chat);\n}","folder":null,"sort":0,"permission":{"default":0,"xqxgNJxuQawzC1dQ":3,"IqlhGYYOCpicp39V":3},"flags":{"core":{"sourceId":"Macro.vReASdOdjdiEwWI3"}},"_id":"ImcVg6DBmZLJsMsA"}
